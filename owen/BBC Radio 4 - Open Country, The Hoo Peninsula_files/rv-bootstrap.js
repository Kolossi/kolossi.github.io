/*
 * jQuery.appear
 * https://github.com/bas2k/jquery.appear/
 * http://code.google.com/p/jquery-appear/
 *
 * Copyright (c) 2009 Michael Hixson
 * Copyright (c) 2012 Alexander Brovikov
 * Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php)
 */

define("plugins/jquery.appear",["jquery-1.9"],function(e){(function(e){e.fn.appear=function(t,n){var r=e.extend({data:undefined,one:!0,accX:0,accY:0},n);return this.each(function(){var n=e(this);n.appeared=!1;if(!t){n.trigger("appear",r.data);return}var i=e(window),s=function(){if(!n.is(":visible")){n.appeared=!1;return}var e=i.scrollLeft(),t=i.scrollTop(),s=n.offset(),o=s.left,u=s.top,a=r.accX,f=r.accY,l=n.height(),c=i.height(),h=n.width(),p=i.width();u+l+f>=t&&u<=t+c+f&&o+h+a>=e&&o<=e+p+a?n.appeared||n.trigger("appear",r.data):n.appeared=!1},o=function(){n.appeared=!0;if(r.one){i.unbind("scroll",s);var o=e.inArray(s,e.fn.appear.checks);o>=0&&e.fn.appear.checks.splice(o,1)}t.apply(this,arguments)};r.one?n.one("appear",r.data,o):n.bind("appear",r.data,o),i.scroll(s),e.fn.appear.checks.push(s),s()})},e.extend(e.fn.appear,{checks:[],timeout:null,checkAll:function(){var t=e.fn.appear.checks.length;if(t>0)while(t--)e.fn.appear.checks[t]()},run:function(){e.fn.appear.timeout&&clearTimeout(e.fn.appear.timeout),e.fn.appear.timeout=setTimeout(e.fn.appear.checkAll,20)}}),e.each(["append","prepend","after","before","attr","removeAttr","addClass","removeClass","toggleClass","remove","css","show","hide"],function(t,n){var r=e.fn[n];r&&(e.fn[n]=function(){var t=r.apply(this,arguments);return e.fn.appear.run(),t})})})(e)}),define("images",["jquery-1.9","plugins/jquery.appear"],function(e){var t=function(e){this.setOptions(e)};return t.prototype={options:{context:e("body"),data_img_src:"data-img-src-",data_img_alt:"data-img-alt",data_lazy_img:"data-lazy-img",data_blank_img:"data-img-blank",rsp_img_css:"rsp-img",lazy_img_css:"lazy-img",valid_img_attributes:["class","id","title","name"],appear:{onscroll:!0,x:200,y:200}},setOptions:function(t){this.options=e.extend({},this.options,t)},init:function(){function r(){t.switchImagesSrc()}var t=this,n;t.switchImagesSrc(),e(window).on("resize",function(){clearTimeout(n),n=setTimeout(r,300)})},getCurrentImageWidth:function(t){return e(t).width()},isResponsiveDataSrcAttribute:function(e){return e.indexOf(this.options.data_img_src)!==-1},getDataSrcWidth:function(e){return parseInt(e.replace(this.options.data_img_src,""))},getImageSrcSizes:function(e){var t=e.attributes,n,r=[];for(var i=0;(n=t[i])!=null;i++)n=t[i].name,this.isResponsiveDataSrcAttribute(n)&&r.push(this.getDataSrcWidth(n));return this.sortSrcSizes(r)},sortSrcSizes:function(e){return e.length?e.sort(function(e,t){return e-t}):!1},getClosestNumber:function(t,n){var r=!1;return e.each(n,function(e,n){if(r==0||Math.abs(n-t)<Math.abs(r-t))r=n}),r},isWidthOverThreshold:function(e,t){return t.length&&e>=t[0]},updateSrcToClosestWidth:function(t,n,r){var i=this.getClosestNumber(n,r),s;i&&(t.setAttribute("src",t.getAttribute(this.options.data_img_src+i)),this.removedSmallestWidthAttributes(t,i,r));var o=this;e(t).bind("load",function(){e(t).removeClass(o.options.lazy_img_css).unbind("load")})},removedSmallestWidthAttributes:function(e,t,n){var r;for(var i=0;(r=n[i])!=null;i++)r<=t&&e.removeAttribute(this.options.data_img_src+r)},hasImageTag:function(e){return e.tagName.toLowerCase()==="img"},convertTagToImage:function(t){var n=t.attributes?t.attributes:e(t)[0].attributes,r,i;return r=this.buildImage(t.getAttribute(this.options.data_blank_img),t.getAttribute(this.options.data_img_alt)),this.copyAttributesToImage(n,r),this.options.appear.onscroll&&e(r).addClass(this.options.lazy_img_css),r},buildImage:function(e,t){var n=document.createElement("img");return n.src=e,n.alt=t?t:"",n},copyAttributesToImage:function(e,t){var n;for(var r=0;(n=e[r])!=null;r++)this.isValidImgAttribute(n.name)&&n.value&&(n.name==="class"?t.className=n.value:t.setAttribute(n.name,n.value))},createResponsiveImage:function(t){var n=this,r=t.alt?t.alt:"bbc programme image",i=t.sources?t.sources:!1,s=e('<img class="'+this.options.rsp_img_css+'" alt="'+r+'" src="'+t.src+'"/>');return e.each(i,function(e,t){s.attr(n.options.data_img_src+t[0],t[1])}),s},isValidImgAttribute:function(e){return this.isResponsiveDataSrcAttribute(e)||this.isValidPossibleAttribute(e)},isValidPossibleAttribute:function(t){return e.inArray(t,this.options.valid_img_attributes)!==-1},switchImagesSrc:function(e){var t=this.getContentResponsiveImages(e),n=this;for(var r=0;(img=t[r])!=null;r++)t[r]=this.switchDiv2Img(img);if(this.options.appear.onscroll)this.addOnScrollHandler(e);else for(var r=0;(img=t[r])!=null;r++)this.processImageSrc(img)},getContentResponsiveImages:function(t){var t=t?t:this.options.context,n=e("."+this.options.rsp_img_css,t);return n.length?n:!1},switchDiv2Img:function(t){if(!this.hasImageTag(t)){var n=t;t=this.convertTagToImage(n),e(n).replaceWith(e(t)),e(t).removeAttr("width").removeAttr("height")}return t},addOnScrollHandler:function(t){var n=this;e("."+this.options.rsp_img_css,t).appear(function(){n.processImageSrc(this)},{accX:n.options.appear.x,accY:n.options.appear.y})},processImageSrc:function(e){var t=this.getCurrentImageWidth(e),n=this.getImageSrcSizes(e);this.isWidthOverThreshold(t,n)&&this.updateSrcToClosestWidth(e,t,n)}},t}),define("lazyload",["jquery-1.9","images","plugins/jquery.appear"],function(e,t){var n=function(e){this.setOptions(e),this.images=new t};return n.prototype={options:{context:e("body"),lazy_module_css:"lazy-module",lazy_css_state:{loading:"lazy-module--loading",complete:"lazy-module--complete",error:"lazy-module--error"},data_threshold:"data-lazyload-threshold",data_always_lazyload:"data-lazyload-always",data_inc_path:"data-lazyload-inc",data_delay_lazyload:"data-lazyload-delay",data_require_hint:"data-lazyload-requirehint",appear:{onscroll:!0,x:200,y:300}},setOptions:function(t){this.options=e.extend({},this.options,t)},init:function(){function r(){t.loadContents()}var t=this,n;this.loadContents(),e(window).on("resize",function(){clearTimeout(n),n=setTimeout(r,300)}),e("body").on("lazyload-refresh",function(e){t.loadContents()})},getLazyContents:function(t){var t=t?t:this.options.context,n=e("."+this.options.lazy_module_css,t).not("."+this.options.lazy_css_state.loading);return n.length?n:!1},isOverThreshold:function(e){var t=e.getAttribute(this.options.data_threshold);return t?this.getWindowWidth()>=t:!1},getWindowWidth:function(){return e(window).width()},alwaysLoadContent:function(e){return e.getAttribute(this.options.data_always_lazyload)=="true"?!0:!1},isDelayed:function(e){return e.getAttribute(this.options.data_delay_lazyload)=="true"},loadContents:function(e){var t=this.getLazyContents(e),n;this.options.appear.onscroll&&this.addOnScrollHandler(e);for(var r=0;(n=t[r])!=null;r++)if(this.isOverThreshold(n)||this.alwaysLoadContent(n))this.loadRequireHints(n),this.isDelayed(n)||this.loadAjaxContent(n)},addOnScrollHandler:function(t){var n=this;e("["+this.options.data_delay_lazyload+"]",t).appear(function(){n.loadAjaxContent(this)},{accX:n.options.appear.x,accY:n.options.appear.y})},loadAjaxContent:function(t){var n=this,t=e(t);return t.addClass(this.options.lazy_css_state.loading),e.ajax({url:t.attr(n.options.data_inc_path),dataType:"html",success:function(r){var i=e(e.parseHTML("<div>"+r+"</div>",document,!0)).addClass(n.options.lazy_css_state.loading);t.replaceWith(i),setTimeout(function(){i.addClass(n.options.lazy_css_state.complete),i.removeClass(n.options.lazy_css_state.loading),n.images.switchImagesSrc(i),i.trigger("lazyloadComplete",{content:i})},1)},error:function(e,r,i){t.removeClass(n.options.lazy_css_state.loading),t.addClass(n.options.lazy_css_state.error)}})},loadRequireHints:function(e){var t=(e.getAttribute(this.options.data_require_hint)||"").split(" ");require(t)}},n}),define("utils",["jquery-1.9"],function(e){return{resizeWithTimeDelay:function(t,n){if(!t||typeof t!="function")return;var r,i=n||300;e(window).on("resize",function(){clearTimeout(r),r=setTimeout(t,i)})}}}),define("statstracking",["jquery-1.9","istats-1"],function(e,t){var n=function(e){this.options={},this.setOptions(e)};return n.prototype={initial_options:{trackingAttribute:"data-linktrack",labelPrefix:"programmes_",appendPositionSuffix:!0,positionSuffix:"_position",elemSelector:".promotion"},setOptions:function(t){this.options=e.extend(!0,{},this.initial_options,t)},init:function(){this.addElemCountSuffix(),this.trackLinks()},addElemCountSuffix:function(){if(!this.options.appendPositionSuffix)return;var t=this,n,r=e(this.options.elemSelector);r.each(function(r){e(this).find("["+t.options.trackingAttribute+"]").each(function(){n=e(this).attr(t.options.trackingAttribute)+t.options.positionSuffix+r,e(this).attr(t.options.trackingAttribute,n)})})},trackLinks:function(){var n=this,r,i=e("["+this.options.trackingAttribute+"]");i.each(function(){r=e(this).attr(n.options.trackingAttribute),t.track("internal",{region:e(this),linkLocation:n.options.labelPrefix+r})})}},n}),define("rv-bootstrap",["jquery-1.9","images","lazyload","utils","statstracking"],function(e,t,n,r,i){return e(function(){var e=new t;e.init();var r=new n;r.init();var s=new i;s.init()}),{$:e,Images:t,Lazyload:n,Utils:r}});