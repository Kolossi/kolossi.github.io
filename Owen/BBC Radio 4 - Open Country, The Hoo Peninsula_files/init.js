define("utils/cookie",[],function(){var e={getAll:function(){if(window.bbccookies===undefined)return{};var e=0,t=window.bbccookies.get().split(";"),n,r,i,s={};for(;e<t.length;e++)r=t[e],r=r.replace(/^\s+|\s+$/g,""),r=r.split("="),n=window.unescape(r[1]),i=window.unescape(r[0]),s[i]=n;return s},get:function(t){var n=e.getAll();return n[t]},set:function(e,t,n,r){return window.bbccookies!==undefined&&(typeof t=="object"&&(t=JSON.stringify(t)),window.bbccookies.set(document.cookie=[encodeURIComponent(e)+"="+window.escape(t),r?"path="+r:"",n?"expires="+n.toUTCString():"","domain=.bbc.co.uk"].join("; "))),!1},remove:function(e){window.bbccookies.set([encodeURIComponent(e)+"=","expires=Thu, 01 Jan 1970 00:00:01 GMT","domain=.bbc.co.uk "].join("; "))}};return e}),define("smp/resume",["jquery-1.9","utils/cookie"],function(e,t){return function(r){var i={resumeArray:[]},s={resumePlayCookieName:"ckps_progs_player_resume"},o=7776e6,u=/t=(.*)/,a=/(?:([0-9]{1,2}?)h)?(?:([0-9]{1,3}?)m)?(?:([0-9]{1,4})s)?/,f={loadCookie:function(){var n=t.get(s.resumePlayCookieName);n&&(i.resumeArray=e.parseJSON(n))},update:function(n){var o=t.get(s.resumePlayCookieName);n=parseInt(n,10);if(n===0)return;o&&(i.resumeArray=f.removeItem(e.parseJSON(o),r)),f.addItem(i.resumeArray,{vpid:r,time:n})},startType:function(){return f.getTimeCodeFromURL()?"time":this.get()>0?"resume":"start"},get:function(){var e=f.getUrlTime(),t=0;return e?t=e:t=f.getTime(r),t},getUrlTime:function(){var e=u.exec(f.getTimeCodeFromURL());return e?f.parseURLTime(e[1]):0},getFormatted:function(){var e=this.get(),t,n,r;return t=Math.floor(e/3600),e-=t*3600,n=Math.floor(e/60),r=e-n*60,n.toString().length<2&&(n="0"+n),r.toString().length<2&&(r="0"+r),[t,n,r].join(":")},remove:function(){var e=new Date((new Date).getTime()+o);i.resumeArray=f.removeItem(i.resumeArray,r),bbccookies.isAllowed("personalisation")&&t.set(s.resumePlayCookieName,i.resumeArray,e,"/programmes")},getTimeCodeFromURL:function(){return window.location.hash},parseURLTime:function(e){var t=a.exec(e),n=0,r=0,i=0;return t&&(n=t[1]?parseInt(t[1],10):0,r=t[2]?parseInt(t[2],10):0,i=t[3]?parseInt(t[3],10):0),n*3600+r*60+i},getTime:function(t){var n=0;return e.each(i.resumeArray,function(e,r){if(r.vpid===t)return n=r.time,!1}),n},removeItem:function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].vpid===t){e.splice(n,1);break}return e},addItem:function(e,n){var r=new Date((new Date).getTime()+o);return e.push(n),e=e.slice(-10),bbccookies.isAllowed("personalisation")&&t.set(s.resumePlayCookieName,e,r,"/programmes"),e}};return{init:function(){f.loadCookie()},update:f.update,get:f.get,getUrlTime:f.getUrlTime,remove:f.remove,startType:f.startType,getFormatted:f.getFormatted,methods:f}}}),define("smp/persistence",["utils/cookie"],function(e){var t={_cookieName:"ckps_progs_playbackCookie",_muted:!1,_volume:.6,_date:"",_NINETY_DAYS:7776e6,_subtitles:!1,getVolume:function(){return this._get("volume")},isMuted:function(){return this._get("muted")},isSubtitlesOn:function(){return this._get("subtitles")},_get:function(t){var n=e.get(this._cookieName),r;if(n){r=JSON.parse(n);if(typeof r[t]!="undefined")return r[t]}return this["_"+t]},set:function(t){t===0&&typeof t=="number"?this._muted=!0:t>0&&typeof t=="number"&&(this._volume=t,this._muted=!1),typeof t=="boolean"?this._subtitles=t:this._subtitles=this._get("subtitles"),this._date=new Date((new Date).getTime()+this._NINETY_DAYS),e.set(this._cookieName,{volume:this._volume,muted:this._muted,subtitles:this._subtitles},this._date,"/programmes")}};return t}),define("smp/init",["jquery-1.9","smp/resume","smp/persistence"],function(e,t,n){var r=function(e){this.resume=null,this.xhrResult=null,this.player=null,this.playerInteracted=!1,this.successfulPlay=!1,this.markers=[],this.options={},this.setOptions(e),this.init()};return r.prototype={initial_options:{container:null,playlist:null,hasSegmentEvents:null,playerSettings:{product:"iplayer",siteID:"iPlayer",appName:"programmes",appType:"web",counterName:window.bbcProgrammes!==undefined?window.bbcProgrammes.counterName:null,playerProfile:"smp",responsive:!0,superResponsive:!0,allowCasting:window.bbcProgrammes!==undefined?window.bbcProgrammes.casting:!1,delayEmbed:!1,requestWMP:!0,playlistObject:null,ui:{},locale:{lang:"en-gb"},embed:{enabled:!0},statsObject:{deviceId:null},muted:null,volume:null,autoplay:!1},rememberResume:!1,messages:{loading:"Loading player...",error:"An error occurred",noVersions:"No available versions"},bbcdotcomAdverts:null,bbcdotcomAnalytics:null,playlistUrlFormat:"/programmes/[[pid]]/playlist.json",UAS:null},setOptions:function(t){this.options=e.extend(!0,{},this.initial_options,t)},init:function(){this.original_page_title=document.title,this.options.playerSettings.muted=n.isMuted(),this.options.playerSettings.volume=n.getVolume();if(this.nopeIsInUrl())return;this.playIsInUrl()&&(this.options.playerSettings.autoplay=!0),window.bbcProgrammes&&window.bbcProgrammes.highlightColour&&(this.options.playerSettings.ui.colour="#"+window.bbcProgrammes.highlightColour,this.options.playerSettings.ui.foreColour="#"+window.bbcProgrammes.highlightText),this.resume=new t(this.options.pid),this.resume.init(),this.options.rememberResume?this.options.playerSettings.startTime=this.resume.get():this.options.playerSettings.startTime=this.resume.getUrlTime(),this.options.pid&&(this.options.playerSettings.statsObject.parentPID=this.options.pid,this.options.playerSettings.externalEmbedUrl="http://www.bbc.co.uk/programmes/"+this.options.pid+"/player"),this.options.playlistObject?this.initWithPlaylistObject():this.options.pid?this.initWithPid():this.options.playlist&&this.initWithPlaylist()},initWithPlaylistObject:function(){var t=this;if(!this.options.playlistObject.defaultAvailableVersion)return;this.options.playerSettings.playlistObject=e.extend(!0,{},this.options.playerSettings.playlistObject,this.options.playlistObject.defaultAvailableVersion.smpConfig),this.options.playlistObject.statsObject&&(this.options.playerSettings.statsObject=e.extend(!0,{},this.options.playerSettings.statsObject,this.options.playlistObject.statsObject)),this.loadPlayer(),this.options.hasSegmentEvents!==!1&&e.ajax({dataType:"json",url:this.getPlaylistUrl(this.options.pid),async:!0,success:function(e){t.xhrResult=e,e.defaultAvailableVersion&&e.defaultAvailableVersion.markers.length>0&&(t.markers=e.defaultAvailableVersion.markers,t.markers.length>0&&(t.options.playerSettings.ui.markers={enabled:!0,hideBelowWidth:480}),t.player&&t.player.setData({name:"SMP.markers",data:t.markers}))}})},initWithPid:function(){this.showLoadingSpinner();var t=e.proxy(this.loadPlayer,this);this.fetchPlaylistForCurrentPid(t,!0)},initWithPlaylist:function(){this.options.playerSettings.playlist=this.options.playlist,this.showLoadingSpinner(),this.loadPlayer()},fetchPlaylistForCurrentPid:function(t,n){var r=this,i=this.getPlaylistUrl(this.options.pid);e.ajax({dataType:"json",url:i,async:n===!1?!1:!0,success:function(n){r.xhrResult=n;if(n.defaultAvailableVersion)r.options.playerSettings.playlistObject=e.extend(!0,{},r.options.playerSettings.playlistObject,n.defaultAvailableVersion.smpConfig),n.statsObject&&(r.options.playerSettings.statsObject=e.extend(!0,{},r.options.playerSettings.statsObject,n.statsObject)),r.markers=n.defaultAvailableVersion.markers,r.markers.length>0?r.options.playerSettings.ui.markers={enabled:!0,hideBelowWidth:480}:r.options.playerSettings.ui.markers={enabled:!1},t(n);else{var i=n.holdingImage||null;r.showLoadingError(r.options.messages.noVersions,i)}},error:function(){r.showLoadingError(r.options.messages.error,null)}})},showLoadingSpinner:function(){var t=e(this.options.container+" .js-loading-message"),n="loading-spinner";t.addClass(n).html(this.options.messages.loading)},showLoadingError:function(t,n){var r=e(this.options.container+" .js-loading-message");r.removeClass("loading-spinner").html(t),n&&e(this.options.container+" .smp__holding").length==0&&e(this.options.container).prepend('<img src="'+n+'" class="rsp-img smp_holding" alt="" />')},loadPlayer:function(e){var t=this;require(["bump-3"],function(e){t.player=e(t.options.container).player(t.options.playerSettings),t.addBindings(),t.addPlugins(),t.player.load()})},getPlaylistUrl:function(e){var t=this.options.playlistUrlFormat;return t.replace("[[pid]]",e)},nopeIsInUrl:function(){var e=window.location.hash;return e.indexOf("nope")>-1},playIsInUrl:function(){var e=window.location.hash;return e.indexOf("play")>-1},triggerSucessfulPlay:function(){this.successfulPlay||(this.successfulPlay=!0,e("body").trigger("smp-successfulPlay"))},addBindings:function(){var r=this,i=e("body"),s,o=0,u=!1;this.player.bind("timeupdate",function(t){var n=Math.floor(t.currentTime),i={currentSeconds:n,totalSeconds:Math.floor(t.duration)};n!==s&&e("body").trigger("smp-beat-second",[i]),s=n,r.options.rememberResume&&s>0&&s!=o&&(o=s,r.resume.update(s)),r.options.UAS&&r.options.UAS.registerHeartbeat(Math.floor(s)),!r.successfulPlay&&s>=30&&r.triggerSucessfulPlay()}),this.player.bind("pause",function(e){r.options.UAS&&r.options.UAS.registerPaused(Math.floor(s))}),this.player.bind("playing",function(e){var t=0;i.trigger("smp-playing",{playerId:r.options.container}),r.playerInteracted=!0,r.options.playerSettings.startTime?t=r.options.playerSettings.startTime:s&&(t=s),r.options.UAS&&r.options.UAS.registerStarted(Math.floor(t)),!r.playIsInUrl()&&!u&&(u=!0,i.trigger("smp-started-manually"))}),this.player.bind("ended",function(e){i.trigger("smp-ended"),r.triggerSucessfulPlay(),r.options.rememberResume&&r.resume.remove(),r.options.UAS&&r.options.UAS.registerEnded(Math.floor(s))}),this.player.bind("initialised",function(){r.markers.length>0&&r.player.setData({name:"SMP.markers",data:r.markers})}),this.player.bind("volumechange",function(e){n.set(e.volume)}),i.on("click","[data-play-from]",function(t){t.preventDefault();var n=e(t.target),i;return n.is("[data-play-from]")||(n=n.parents("[data-play-from]")),i=n.attr("data-play-from"),r.jumpTo(parseInt(i,10)),window.scrollTo(0,0),!1}),i.on("smp-pause",function(e){r.player.pause()}),i.on("smp-destroy",function(e){r.player.suspend(),r.player.bind("playing",function(){r.player.suspend()})}),i.on("smp-queue-new",function(e,n,i,s){r.player.queuePlaylist(i,s),r.player.bind("playlistLoaded",function(){r.resume=new t(n),r.resume.init()})}),i.on("smp-playing",function(e,t){t&&t.playerId&&t.playerId!=r.options.container&&r.player.pause()})},addPlugins:function(){var t=e(this.options.container).get(0).id;this.options.bbcdotcomAdverts&&this.options.bbcdotcomAdverts.addSmpPlugin(t,this.player),this.options.bbcdotcomAnalytics&&this.options.bbcdotcomAnalytics.addEventListeners(this.player)},jumpTo:function(e){var t=this;this.player.settings.startTime=e,setTimeout(function(){t.player.play()},100),this.player.currentTime(e)},resetCurrentVideo:function(){this.options.playerSettings.statsObject=this.initial_options.playerSettings.statsObject,this.options.playerSettings.externalEmbedUrl="",this.options.playerSettings.startTime=0,this.options.playerSettings.playlistObject=null,this.markers=[],this.resume=null},playNewPid:function(n,r){var i=this;this.options.pid=n,this.resetCurrentVideo();var s=e("<div />",{"class":"smp__overlay"});s.append(e("<div />",{"class":"smp__message js-loading-message loading-spinner",html:this.options.messages.loading})),e(this.options.container).append(s),this.options.playerSettings.statsObject.parentPID=this.options.pid,this.options.playerSettings.externalEmbedUrl="http://www.bbc.co.uk/programmes/"+this.options.pid+"/player",this.options.rememberResume?(this.resume=new t(this.options.pid),this.resume.init(),this.options.playerSettings.startTime=this.resume.get()):this.options.playerSettings.startTime=0;var o=this.player.decide(),u=!0;o=="smphtml5"&&!this.playerInteracted&&r&&(u=!1),this.fetchPlaylistForCurrentPid(function(e){s.remove();var t={autoplay:r,statsObject:i.options.playerSettings.statsObject,startTime:i.options.playerSettings.startTime};e.holdingImage&&(t.overrideHoldingImage=e.holdingImage),i.player.loadPlaylist(i.options.playerSettings.playlistObject,t)},u)},playNewPlaylist:function(e,t){this.options.pid=null,this.resetCurrentVideo();var n={autoplay:t,statsObject:this.options.playerSettings.statsObject,startTime:this.options.playerSettings.startTime};this.player.loadPlaylist(e,n)}},r});